<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctor Dashboard - RecoveryLink</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 250px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            padding: 20px 0;
        }

        .nav-btn {
            width: 100%;
            padding: 15px 25px;
            border: none;
            background: none;
            text-align: left;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }

        .nav-btn:hover {
            background: #f8f9fa;
        }

        .nav-btn.active {
            background: #50BFC3;
            color: white;
            border-left: 4px solid #3a9ca0;
        }

        .nav-btn.logout {
            color: #dc3545;
            margin-top: 20px;
        }

        .content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .alert-card {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .chat-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .chat-item:hover {
            transform: translateY(-2px);
        }

        .chat-item b {
            color: #2c3e50;
            display: block;
            margin-bottom: 5px;
        }

        .chat-item p {
            color: #7f8c8d;
            font-size: 14px;
        }

        .settings-group {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .settings-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2c3e50;
        }

        .settings-group input {
            width: 100px;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .dashboard-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .patient-list {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .patient-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
        }

        .patient-row:last-child {
            border-bottom: none;
        }

        .patient-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .pain-level {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .pain-low { background: #d4edda; color: #155724; }
        .pain-medium { background: #fff3cd; color: #856404; }
        .pain-high { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="sidebar">
        <button class="nav-btn active" data-page="dashboard">üìä Dashboard</button>
        <button class="nav-btn" data-page="alerts">üö® Alerts</button>
        <button class="nav-btn" data-page="messages">üí¨ Messages</button>
        <button class="nav-btn" data-page="settings">‚öôÔ∏è Settings</button>
        <button class="nav-btn logout">üö™ Logout</button>
    </div>

    <div class="content">
        <section id="dashboard" class="page active">
            <h2>Doctor Command Center</h2>
            
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3>üìà Today's Overview</h3>
                    <p><strong>Total Patients:</strong> <span id="totalPatients">0</span></p>
                    <p><strong>Critical Alerts:</strong> <span id="criticalAlerts">0</span></p>
                    <p><strong>New Messages:</strong> <span id="newMessages">0</span></p>
                </div>
                
                <div class="dashboard-card">
                    <h3>‚ö° Quick Actions</h3>
                    <button onclick="refreshData()" style="padding: 8px 16px; margin: 5px; border: none; background: #50BFC3; color: white; border-radius: 4px; cursor: pointer;">Refresh Data</button>
                    <button onclick="exportReport()" style="padding: 8px 16px; margin: 5px; border: none; background: #6c757d; color: white; border-radius: 4px; cursor: pointer;">Export Report</button>
                </div>
            </div>

            <div class="patient-list">
                <div class="patient-row" style="background: #f8f9fa; font-weight: 600;">
                    <span>Patient Name</span>
                    <span>Pain Level</span>
                    <span>Last Check-in</span>
                </div>
                <div id="patientsList"></div>
            </div>
        </section>

        <section id="alerts" class="page">
            <h2>üö® Critical Alerts</h2>
            <div id="alertsList"></div>
        </section>

        <section id="messages" class="page">
            <h2>üí¨ Patient Messages</h2>
            <div id="chatList"></div>
        </section>

        <section id="settings" class="page">
            <h2>‚öôÔ∏è Settings</h2>
            
            <div class="settings-group">
                <label>
                    Alert Threshold (Pain Level)
                    <input type="number" id="alertThreshold" value="7" min="1" max="10">
                </label>
                <small style="color: #6c757d;">Patients with pain level at or above this value will trigger alerts</small>
            </div>

            <div class="settings-group">
                <label>
                    Auto-refresh Interval (seconds)
                    <input type="number" id="refreshInterval" value="30" min="10" max="300">
                </label>
                <small style="color: #6c757d;">How often to check for new patient data</small>
            </div>
        </section>
    </div>

    <script>
        // Sample patient data (simulate backend)
        const patients = JSON.parse(localStorage.getItem("patients")) || [
            { name: "Rahul Sharma", pain: 8, lastCheckin: "2 hours ago" },
            { name: "Amit Patel", pain: 4, lastCheckin: "1 hour ago" },
            { name: "Priya Singh", pain: 9, lastCheckin: "30 minutes ago" },
            { name: "Vikram Kumar", pain: 3, lastCheckin: "4 hours ago" },
            { name: "Sneha Gupta", pain: 7, lastCheckin: "1 hour ago" }
        ];

        // Mock chat data
        const chats = [
            { patient: "Rahul Sharma", last: "Pain increased today, feeling dizzy" },
            { patient: "Priya Singh", last: "Severe pain in surgical area" },
            { patient: "Amit Patel", last: "Feeling much better, thank you" },
            { patient: "Sneha Gupta", last: "Some swelling noticed" }
        ];

        // Navigation Logic
        const buttons = document.querySelectorAll(".nav-btn");
        const pages = document.querySelectorAll(".page");

        buttons.forEach(btn => {
            btn.addEventListener("click", () => {
                const page = btn.dataset.page;

                // Logout
                if (btn.classList.contains("logout")) {
                    localStorage.clear();
                    window.location.href = "login.html";
                    return;
                }

                // Active button
                buttons.forEach(b => b.classList.remove("active"));
                btn.classList.add("active");

                // Show page
                pages.forEach(p => p.classList.remove("active"));
                document.getElementById(page).classList.add("active");
            });
        });

        // Load Dashboard Data
        function loadDashboard() {
            const patientsList = document.getElementById("patientsList");
            const totalPatients = document.getElementById("totalPatients");
            const criticalAlerts = document.getElementById("criticalAlerts");
            
            patientsList.innerHTML = "";
            let criticalCount = 0;

            patients.forEach(p => {
                if (p.pain >= 7) criticalCount++;
                
                const row = document.createElement("div");
                row.className = "patient-row";
                
                let painClass = "pain-low";
                if (p.pain >= 7) painClass = "pain-high";
                else if (p.pain >= 5) painClass = "pain-medium";
                
                row.innerHTML = `
                    <span class="patient-name">${p.name}</span>
                    <span class="pain-level ${painClass}">${p.pain}/10</span>
                    <span>${p.lastCheckin}</span>
                `;
                patientsList.appendChild(row);
            });

            totalPatients.textContent = patients.length;
            criticalAlerts.textContent = criticalCount;
            document.getElementById("newMessages").textContent = chats.length;
        }

        // Load Alerts
        function loadAlerts() {
            const alertsList = document.getElementById("alertsList");
            const threshold = parseInt(localStorage.getItem("alertThreshold")) || 7;
            
            alertsList.innerHTML = "";

            patients.forEach(p => {
                if (p.pain >= threshold) {
                    const alert = document.createElement("div");
                    alert.innerHTML = `
                        <div class="alert-card">
                            üö® <b>${p.name}</b> - Pain level ${p.pain}/10 (CRITICAL)
                            <br><small>Last check-in: ${p.lastCheckin}</small>
                        </div>
                    `;
                    alertsList.appendChild(alert);
                }
            });

            if (alertsList.children.length === 0) {
                alertsList.innerHTML = '<p style="color: #28a745; font-weight: 600;">‚úÖ No critical alerts at this time</p>';
            }
        }

        // Load Messages
        function loadMessages() {
            const chatList = document.getElementById("chatList");
            chatList.innerHTML = "";

            chats.forEach(c => {
                const div = document.createElement("div");
                div.className = "chat-item";
                div.innerHTML = `
                    <b>${c.patient}</b>
                    <p>${c.last}</p>
                `;
                div.onclick = () => alert(`Opening chat with ${c.patient}`);
                chatList.appendChild(div);
            });
        }

        // Settings
        document.getElementById("alertThreshold").addEventListener("change", e => {
            localStorage.setItem("alertThreshold", e.target.value);
            loadAlerts(); // Refresh alerts with new threshold
        });

        document.getElementById("refreshInterval").addEventListener("change", e => {
            localStorage.setItem("refreshInterval", e.target.value);
        });

        // Load saved settings
        document.getElementById("alertThreshold").value = localStorage.getItem("alertThreshold") || 7;
        document.getElementById("refreshInterval").value = localStorage.getItem("refreshInterval") || 30;

        // Utility functions
        function refreshData() {
            loadDashboard();
            loadAlerts();
            loadMessages();
            alert("Data refreshed successfully!");
        }

        function exportReport() {
            const report = {
                timestamp: new Date().toISOString(),
                totalPatients: patients.length,
                criticalAlerts: patients.filter(p => p.pain >= 7).length,
                patients: patients
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `patient-report-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
        }

        // Initialize on page load
        document.addEventListener("DOMContentLoaded", () => {
            loadDashboard();
            loadAlerts();
            loadMessages();
        });

        // Auto-refresh (optional)
        setInterval(() => {
            const interval = parseInt(localStorage.getItem("refreshInterval")) || 30;
            if (interval > 0) {
                loadDashboard();
                loadAlerts();
            }
        }, 30000); // 30 seconds default
    </script>
</body>
</html>
